# new和malloc的区别

---

### 面试标准回答

“malloc 是 C 库函数，只分配原始字节内存，返回 void\*，不会调用构造函数，释放时用 free；
new 是 C++ 关键字，负责分配内存并调用构造函数进行初始化，返回类型安全的指针，释放时用 delete 并调用析构函数。
malloc/free 适合纯 C 风格的内存管理，而在 C++ 中应优先使用 new/delete，因为它们与对象的构造和析构语义绑定在一起。”

---

### 1. malloc（C 语言内存分配函数）

* **定义**：C 标准库函数，原型 `void* malloc(size_t size)`。
* **功能**：在堆上分配指定字节数的原始内存。
* **特点**：

  * 参数是字节数，需要手动计算大小，例如 `malloc(10 * sizeof(int))`。
  * 返回 `void*`，需要在 C++ 中强制类型转换。
  * **不会调用构造函数**，只提供原始的内存块。
  * 释放时必须用 `free`。

---

### 2. new（C++ 运算符）

* **定义**：C++ 的关键字/运算符。
* **功能**：在堆上分配指定类型对象的内存，并调用构造函数初始化。
* **特点**：

  * 语法简洁：`int* p = new int(5);`。
  * 不需要手动计算字节数，编译器自动推导。
  * 返回的就是对应类型的指针，不需要强制转换。
  * 会调用构造函数（对象/数组都支持），保证对象初始化。
  * 释放时必须用 `delete` 或 `delete[]`，同时调用析构函数。

---

### 3. 对比总结

| 特性              | malloc/free      | new/delete                   |
| ----------------- | ---------------- | ---------------------------- |
| 所属语言          | C 标准库函数     | C++ 关键字/运算符            |
| 返回类型          | `void*`，需强转  | 类型安全，直接返回对应指针   |
| 初始化            | 不初始化         | 调用构造函数初始化           |
| 分配失败          | 返回 `NULL`      | 抛出 `std::bad_alloc` 异常   |
| 销毁              | `free`，不调析构 | `delete`，会调用析构函数     |
| 参数              | 字节数           | 类型和数量，自动推导字节数   |
| 重载/自定义分配器 | 不支持           | 可重载 `operator new/delete` |
