---
created: '2025-10-19'
last_reviewed: null
next_review: '2025-10-19'
review_count: 0
difficulty: medium
mastery_level: 0.0
tags:
- 熟悉大语言模型推理优化-技术层次
- 熟悉大语言模型推理优化-技术层次/序列并行如何沿序列维度切分？.md
related_outlines: []
---
# 序列并行如何沿序列维度切分？

## 面试标准答案

序列并行将输入序列在序列长度维度上切分到不同GPU，每个GPU处理部分序列位置。切分方式是将[B,S,H]的张量变为[B,S/N,H]，其中N是并行度。适用于LayerNorm、Dropout等逐元素操作。与张量并行结合时需要All-to-All通信在特征分片和序列分片间转换。优势是大幅减少激活显存(降至1/N)，特别适合长序列场景。主要用于训练，推理时因序列较短收益有限。

---

## 详细讲解

### 切分方式

```python
# 原始输入
X: [Batch, Seq_len, Hidden]  # [32, 2048, 12288]

# 序列并行(4-way)
X_per_gpu: [32, 512, 12288]  # 每个GPU 1/4序列

# 切分代码
seq_len_per_gpu = seq_len // world_size
X_local = X[:, rank*seq_len_per_gpu:(rank+1)*seq_len_per_gpu, :]
```

### 适用算子

**可直接在序列分片上计算**:
- LayerNorm (在hidden维度归一化)
- Dropout (逐元素)
- 激活函数 (逐元素)
- 残差连接

**需要特殊处理**:
- Attention (需要完整序列)
- 矩阵乘法 (需要特征维度切分)

### 与张量并行结合

```python
# 流程
1. 张量并行输出: [B, S, H/N] (特征分片)
2. All-to-All转换: [B, S/N, H] (序列分片)
3. LayerNorm等操作
4. All-to-All转回: [B, S, H/N] (特征分片)
```

### 显存节省

```
标准: LayerNorm输入 [32, 2048, 12288] = 1.6GB
序列并行(8-way): [32, 256, 12288] = 0.2GB
节省: 87.5%
```

序列并行主要优势在于长序列训练时的显存优化。


---

## 相关笔记
<!-- 自动生成 -->

- [序列并行适用于哪些算子（LayerNorm、Dropout）？](notes/熟悉大语言模型推理优化-技术层次/序列并行适用于哪些算子（LayerNorm、Dropout）？.md) - 相似度: 33% | 标签: 熟悉大语言模型推理优化-技术层次, 熟悉大语言模型推理优化-技术层次/序列并行适用于哪些算子（LayerNorm、Dropout）？.md
- [序列并行是什么？](notes/熟悉大语言模型推理优化-技术层次/序列并行是什么？.md) - 相似度: 33% | 标签: 熟悉大语言模型推理优化-技术层次, 熟悉大语言模型推理优化-技术层次/序列并行是什么？.md
- [序列并行如何与张量并行结合？](notes/熟悉大语言模型推理优化-技术层次/序列并行如何与张量并行结合？.md) - 相似度: 31% | 标签: 熟悉大语言模型推理优化-技术层次, 熟悉大语言模型推理优化-技术层次/序列并行如何与张量并行结合？.md
- [序列并行如何与张量并行结合使用？](notes/熟悉大语言模型推理优化-技术层次/序列并行如何与张量并行结合使用？.md) - 相似度: 31% | 标签: 熟悉大语言模型推理优化-技术层次, 熟悉大语言模型推理优化-技术层次/序列并行如何与张量并行结合使用？.md

