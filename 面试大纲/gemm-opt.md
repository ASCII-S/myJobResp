# GEMM优化面试大纲

## 面试背景
针对简历中提到"熟悉常用的性能优化技巧，并且对矩阵乘GEMM有优化经验"的应届生候选人，本大纲旨在全面考核其在高性能计算、矩阵运算优化方面的理论基础和实践能力。

---
[[toc]]
---

## 一、基础理论考核（15-20分钟）

### 1.1 GEMM基础概念
- **问题导入**：请解释什么是GEMM，它在现代计算中的重要性
  - 考查点：对General Matrix Multiply的理解
  - 深入：GEMM在深度学习、科学计算中的应用场景
  - 扩展：与其他BLAS操作的关系（GEMV、AXPY等）

### 1.2 计算复杂度分析
- **核心问题**：分析朴素矩阵乘法的时间和空间复杂度
  - 考查点：Big O符号表示，理解O(n³)复杂度
  - 进阶：Strassen算法等优化算法的复杂度
    - [../notes/gemm-opt/Strassen.md](../notes/gemm-opt/Strassen.md)
  - 实际应用：在什么场景下这些理论算法实用性有限

### 1.3 内存层次结构认知
- **基础考查**：描述现代计算机的内存层次结构
  - 考查点：寄存器→L1缓存→L2缓存→L3缓存→主内存→存储
  - 性能差异：各层级的访问延迟和带宽差异
  - 容量限制：各级缓存的典型容量范围
  - [../notes/gemm-opt/memory-hierarchy.md](../notes/gemm-opt/memory-hierarchy.md)

---

## 二、核心优化技术考核（25-30分钟）

### 2.1 缓存优化策略
#### 2.1.1 数据分块技术（Cache Blocking/Tiling）
- **理论问题**：
  - 解释为什么需要分块，分块如何提升缓存命中率
  - 如何确定最优的块大小？考虑因素有哪些？
  - [../notes/gemm-opt/cache-blocking.md](../notes/gemm-opt/cache-blocking.md)
- **实践问题**：
  - 给定L1缓存32KB的限制，如何设计三层循环的分块策略
  - 嵌套分块：如何针对多级缓存设计多层分块
- **代码实现**：
  - 要求手写简单的分块GEMM伪代码
  - 分析不同分块策略的优缺点

#### 2.1.2 内存访问模式优化
- **访问局部性**：
  - 空间局部性vs时间局部性在GEMM中的体现
  - 行优先vs列优先访问对性能的影响
- **预取策略**：
  - 软件预取和硬件预取的区别
  - 在GEMM中如何合理使用预取指令
  - [../notes/gemm-opt/prefetch.md](../notes/gemm-opt/prefetch.md)

### 2.2 并行化技术
#### 2.2.1 SIMD向量化
- **理论基础**：
  - 解释SIMD的概念和在矩阵运算中的应用
  - AVX、SSE指令集的特点和使用场景
- **实现考查**：
  - 如何将标量GEMM代码向量化
  - 数据对齐对SIMD性能的影响
  - 处理非对齐矩阵维度的策略
  - 打包优化技术
  - [../notes/gemm-opt/packing_microkernel.md](../notes/gemm-opt/packing_microkernel.md)

#### 2.2.2 多线程并行
- **并行策略**：
  - 数据并行vs任务并行在GEMM中的应用
  - OpenMP在矩阵运算中的使用
- **负载均衡**：
  - 如何避免线程间的负载不均
  - 动态调度vs静态调度的选择

### 2.3 算法层面优化
#### 2.3.1 循环重排和展开
- **循环顺序**：
  - 六种可能的三重循环顺序，哪种最优？为什么？
  - 循环交换对缓存行为的影响
- **循环展开**：
  - 展开因子的选择原则
  - 展开对寄存器压力的影响

#### 2.3.2 寄存器优化
- **寄存器分块**：
  - 如何设计寄存器级别的分块
  - 寄存器压力和并行度的权衡
- **数据重用**：
  - 如何最大化寄存器中数据的重用率

---

## 三、平台特定优化（20-25分钟）

### 3.1 CPU优化技术
#### 3.1.1 高性能库使用
- **BLAS库经验**：
  - 使用过哪些BLAS库（OpenBLAS、Intel MKL、ATLAS等）
  - 不同库的性能特点和适用场景
- **库调用优化**：
  - 如何正确调用DGEMM/SGEMM函数
  - 参数设置对性能的影响（alpha、beta、转置等）

#### 3.1.2 编译器优化
- **优化选项**：
  - 常用的编译器优化标志（-O3、-march、-mtune等）
  - 自动向量化的局限性和手动干预
- **性能分析工具**：
  - 使用过哪些性能分析工具（perf、VTune、gprof等）
  - 如何解读性能报告，定位瓶颈

### 3.2 GPU优化技术（如有相关经验）
#### 3.2.1 CUDA GEMM优化
- **内存管理**：
  - 全局内存、共享内存、寄存器的使用策略
  - Coalesced访问模式的重要性
- **线程组织**：
  - 线程块和网格的合理设计
  - Warp级别的优化考虑
- **高级技术**：
  - Tensor Core的使用（如A100、V100等）
  - 双缓冲技术实现计算与访存重叠

#### 3.2.2 cuBLAS使用经验
- **库函数调用**：
  - cublasGemm系列函数的正确使用
  - 数据格式和内存布局的处理
- **性能调优**：
  - 不同精度（FP32、FP16、INT8）的性能差异
  - 批处理GEMM的优化策略

---

## 四、实际项目经验考核（15-20分钟）

### 4.1 项目背景深入
- **具体应用场景**：
  - 在什么项目中使用了GEMM优化？
  - 矩阵规模大小、计算频率、性能要求
- **优化动机**：
  - 原始实现的性能瓶颈在哪里？
  - 如何识别和定位性能问题？

### 4.2 优化实施过程
- **优化策略选择**：
  - 采用了哪些具体的优化技术？
  - 为什么选择这些技术而不是其他方案？
- **实现细节**：
  - 遇到的主要技术难点
  - 如何解决内存限制、数值稳定性等问题
- **性能评估**：
  - 使用了哪些性能指标（FLOPS、延迟、吞吐量等）
  - 优化前后的具体性能提升数据

### 4.3 工程实践能力
- **代码质量**：
  - 如何保证优化代码的正确性？
  - 测试策略和验证方法
- **可维护性**：
  - 如何在性能优化和代码可读性之间平衡
  - 参数调优和可配置性设计
- **跨平台适配**：
  - 是否考虑了不同硬件平台的适配
  - 如何处理硬件特性差异

---

## 五、进阶话题探讨（10-15分钟）

### 5.1 数值计算考虑
- **精度问题**：
  - 浮点运算的精度损失
  - 大规模矩阵乘法中的数值稳定性
- **混合精度**：
  - FP16、BF16在GEMM中的应用
  - 精度和性能的权衡策略

### 5.2 内存优化高级话题
- **内存带宽限制**：
  - 如何达到理论峰值性能
  - Roofline模型的应用
- **大规模矩阵处理**：
  - 超出内存限制的矩阵如何处理
  - 分布式GEMM的基本思路

### 5.3 前沿技术了解
- **稀疏矩阵优化**：
  - 稀疏GEMM的特殊考虑
  - 稀疏性利用策略
- **新硬件架构**：
  - AI加速器（TPU、昇腾等）的特点
  - 新指令集的发展趋势

---

## 六、技术深度验证（可选扩展）

### 6.1 代码实现能力
- **现场编程**：
  - 实现一个简单的分块GEMM函数
  - 分析给定代码的性能瓶颈

### 6.2 性能分析能力
- **案例分析**：
  - 给出性能数据，分析可能的优化方向
  - 设计实验验证优化效果

### 6.3 问题解决能力
- **故障排查**：
  - 性能异常的可能原因
  - 系统性的问题定位方法

---

## 评分标准建议

### 优秀水平（85-100分）
- 深入理解GEMM优化的核心原理
- 有丰富的实际优化经验和具体项目案例
- 能够独立设计和实现高效的GEMM算法
- 对前沿技术有一定了解和思考

### 良好水平（70-84分）
- 掌握基本的优化技术和原理
- 有一定的实践经验，能够在指导下完成优化工作
- 理解性能分析的基本方法

### 及格水平（60-69分）
- 了解基本概念，但缺乏深入理解
- 有限的实际经验，主要停留在理论层面
- 需要较多指导才能进行优化工作

### 不及格（<60分）
- 基本概念不清楚或有明显错误理解
- 缺乏实际经验，无法证明简历中的相关能力

---

## 面试官注意事项

1. **循序渐进**：从基础概念开始，根据回答质量逐步深入
2. **理论结合实际**：重点考查理论知识在实际项目中的应用
3. **鼓励讨论**：对于复杂问题，可以引导面试者进行开放式讨论
4. **验证真实性**：通过深入的技术细节来验证简历经验的真实性
5. **适度调整**：根据面试者的回答水平，灵活调整问题的深度和广度

本大纲旨在全面评估面试者的GEMM优化能力，每个模块都可以根据具体需要进行扩展或调整。
